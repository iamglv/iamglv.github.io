<html>
  <head>
</platform>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous"/>
    <title>Countdown e Progressbar</title>
    <style>

body {
font-family: Trebuchet MS;
}

body.popup-active {
        filter: blur(5px);
        opacity: 0.5;
      }

body::before {
  content: "";
  background-color: rgba(0, 0, 0, 0.5);
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}

      /* Stili per l'immagine centrata */
      #image {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      #image img {
  max-width: 300%;
  height: auto;
  width: 80%;
}
      /* Stili per la progressbar */
      #progressbar {
        margin: 25px auto;
        width: 80%;
        background-color: rgb(237, 227, 227);
        height: 10%;
        text-align: center;
        position: relative;
      }
      /* Stili per il riempimento della progressbar */
      #progress {
        background-color: yellow;
  height: 100%;
  position: absolute;
  width: 100%;
  transition: width 1s linear;
      }

      #countdown {
  text-align: center;
  padding: 10px;
  font-size: 300%;
}

#popup {
    width: 80%;
  height: 40%;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  font-size: 300%;
}

#countdown, #progressbar {
  display: none;
}

#start-btn {
  background-color: red;
  color: white;
  font-size: 150%;
  padding: 10px 20px;
  border-radius: 15px;
}
    </style>
  </head>
  <body>
    <div id="popup">
        <p>Pronto per iniziare?</p>
        <button id="start-btn">Inizia</button>
      </div>
    <div id="image">
      <img src="/urteeth/media/urteeth_ll.png" id="img">
    </div>
    <div id="countdown"></div>
    <div id="progressbar">
      <div id="progress"></div>
    </div>
    
    <!-- Modal: id="myModal" -->
    <div
      class="modal fade"
      id="myModal"
      tabindex="-1"
      aria-labelledby="myModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="myModalLabel">Finito!</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
Complimenti! Forse non te ne sei accorto, ma sono gia passati 2 minuti e mezzo! Torna domani, ti aspetto.
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>

    <script>

let isCountdownRunning = false;

function updateCountdown() {
  if (!isCountdownRunning) {
    isCountdownRunning = true;
    countdown.innerHTML = timeLeft;
    timeLeft--;
    if (timeLeft < 0) {
      clearTimeout(countdownInterval);
      //...
    }
    countdownInterval = setTimeout(() => {
      updateCountdown();
      isCountdownRunning = false;
    }, 1000);
  }
}

window.onload = function() {
  document.getElementById("popup").style.display = "block";
};



let startButton = document.getElementById("start-btn");
startButton.addEventListener("click", function() {
  document.getElementById("countdown").style.display = "block";
  document.getElementById("progressbar").style.display = "block";
  document.getElementById("popup").style.display = "none";
  countdownInterval = setInterval(() => {
    updateCountdown();
    updateProgress();
  }, 1000);
});

      // Variabile per tenere traccia del tempo rimasto
      let timeLeft = 25;
      // Crea un riferimento all'elemento countdown
      let countdown = document.getElementById("countdown");
      // Crea un riferimento all'elemento progress
      let progress = document.getElementById("progress");
      // Crea un riferimento all'elemento immagine
      let img = document.getElementById("img");
      
      // // Funzione per aggiornare il countdown
      // function updateCountdown() {
      //   countdown.innerHTML = timeLeft;
      //   timeLeft--;
      //   if (timeLeft < 0) {
      //     clearInterval(countdownInterval);
      //     timeLeft = 20;
      //     img.src = "media/urteeth ur.png";
      //     progress.style.width = "100%";
      //     countdownInterval = setInterval(() => {
      //       updateCountdown();
      //       updateProgress();
      //     }, 1000);
      //   }
      // }
      
      let images = ["media/urteeth_ll.png", "media/urteeth_lr.png", "media/urteeth_ul.png", "media/urteeth_ur.png", "media/urteeth_smile.png", "media/urteeth_smile_behind.png"];
let count = 1;

function updateCountdown() {
  countdown.innerHTML = timeLeft;
  timeLeft--;
  if (timeLeft < 0) {
    img.src = images[count];
    count++;
    if (count === 7) {
      clearInterval(countdownInterval);
        // https://getbootstrap.com/docs/5.0/components/modal/#via-javascript
        let myModal = new bootstrap.Modal(
          document.getElementById("myModal"),
          {}
        );
        // https://getbootstrap.com/docs/5.0/components/modal/#show
        myModal.show();

      return;
    }
    timeLeft = 25;
    progress.style.width = "100%";
  }
}

      // Funzione per aggiornare la progressbar
      function updateProgress() {
        progress.style.width = `${timeLeft / 25 * 100}%`;
      }
      
      // Crea un interval per aggiornare il countdown ogni secondo
      let countdownInterval = setTimeout(() => {
        updateCountdown();
        updateProgress();
      }, 1000);


    </script>
  </body>
</html>